<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>The HTML5 Herald</title>
  <meta name="description" content="Brian">
  <meta name="author" content="Steve Lee">

  <meta name="google-signin-client_id" content="565029808164-fnpc091ed2l5a03bhmq4apanav362a7h.apps.googleusercontent.com">

</head>

<body>
<p>Brian login test</p>

<div id="my-signin2" class="my-signin2"></div>
  
    <script>
    function onSuccess(googleUser) {
      var profile = googleUser.getBasicProfile();
      console.log('Logged in as: ' + profile.getName() + ' ' + profile.getEmail());
      var authresp = googleUser.getAuthResponse();
      console.log('id_token: ' + authresp.id_token);
      console.info('access_token: ' + authresp.access_token);
    
    
      // validate token and check client id is correct
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'https://www.googleapis.com/oauth2/v3/tokeninfo?access_token='+authresp.access_token);
      xhr.onload = function() {
        var jsonPretty = JSON.stringify(JSON.parse(xhr.responseText),null,2);  
        console.log('Output:\n' + jsonPretty);
      
        var xhr2 = new XMLHttpRequest();
        xhr2.open('POST', "https://picasaweb.google.com/data/feed/api/user/default?alt=json&access_token=" + authresp.access_token);
  //      xhr2.setRequestHeader('GData-Version', '2');
//        xhr2.setRequestHeader('Authorization', 'Bearer ' + authresp.access_token);
        xhr2.onload = function() {
          var jsonPretty2 = JSON.stringify(JSON.parse(xhr2.responseText),null,2);  
          console.log('Output:\n' + jsonPretty2);
        };
      xhr2.send();

      };
    xhr.send();
      
      
    }
    function onFailure(error) {
      console.log('fail '+error);
    }
    function renderButton() {
      console.log('a');
      gapi.signin2.render('my-signin2', {
        'scope': 'profile email https://picasaweb.google.com/data/', //https://www.googleapis.com/auth/drive.photos.readonly
        'width': 240,
        'height': 50,
        'longtitle': true,
        'theme': 'dark',
        'onsuccess': onSuccess,
        'onfailure': onFailure
      });
      console.log('b');
    }

  </script>

<a href="#" onclick="signOut();">Sign out</a>
<script>
  function signOut() {
    var auth2 = gapi.auth2.getAuthInstance();
    auth2.signOut().then(function () {
      console.log('User signed out.');
    });
  }
</script>

  <script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>
</body>
</html>
